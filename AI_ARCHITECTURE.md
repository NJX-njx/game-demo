# AI系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                      游戏主循环 (Game.js)                         │
│                                                                   │
│  • 初始化AI管理器                                                  │
│  • 每帧更新AI系统                                                  │
│  • 协调所有游戏组件                                                │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                    AI管理器 (AIManager)                           │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  核心功能                                                  │   │
│  │  • 难度管理: EASY / NORMAL / HARD / ADAPTIVE             │   │
│  │  • 玩家表现追踪 (伤害、击杀、死亡、技巧)                     │   │
│  │  • 动态难度调整算法                                        │   │
│  │  • NPC对话上下文管理                                       │   │
│  │  • AI助手系统                                             │   │
│  └──────────────────────────────────────────────────────────┘   │
└───────┬──────────────┬──────────────┬──────────────┬───────────┘
        │              │              │              │
        ▼              ▼              ▼              ▼
┌──────────────┐ ┌──────────────┐ ┌─────────────┐ ┌─────────────┐
│  敌人AI系统   │ │ 玩家表现分析  │ │  NPC对话AI  │ │  AI助手     │
└──────────────┘ └──────────────┘ └─────────────┘ └─────────────┘
        │              │              │              │
        ▼              │              │              │
┌─────────────────────────────────────────────────┐ │              │
│      增强敌人AI (EnhancedEnemyAI)                 │ │              │
│  ┌──────────────────────────────────────────┐   │ │              │
│  │  AI行为策略                               │   │ │              │
│  │  ┌─────────────┬─────────────┬─────────┐│   │ │              │
│  │  │ AGGRESSIVE  │ DEFENSIVE   │ TACTICAL││   │ │              │
│  │  │  激进型      │  防御型      │  战术型  ││   │ │              │
│  │  │ • 主动追击   │ • 保持距离   │ • 智能   ││   │ │              │
│  │  │ • 频繁攻击   │ • 高闪避率   │   判断   ││   │ │              │
│  │  └─────────────┴─────────────┴─────────┘│   │ │              │
│  │                                          │   │ │              │
│  │  ┌─────────────────────────────────────┐│   │ │              │
│  │  │      ADAPTIVE (自适应)                ││   │ │              │
│  │  │  根据玩家表现动态调整策略              ││   │ │              │
│  │  └─────────────────────────────────────┘│   │ │              │
│  │                                          │   │ │              │
│  │  AI决策流程                               │   │ │              │
│  │  1. 感知环境 (perceive)                   │   │ │              │
│  │     • 检测玩家位置                         │   │ │              │
│  │     • 判断距离和视野                        │   │ │              │
│  │     • 更新记忆                            │   │ │              │
│  │                                          │   │ │              │
│  │  2. 智能决策 (makeDecision)               │   │ │              │
│  │     • 根据策略选择行动                      │   │ │              │
│  │     • 考虑血量和威胁                        │   │ │              │
│  │     • 动态调整计划                         │   │ │              │
│  │                                          │   │ │              │
│  │  3. 执行动作 (executeAction)              │   │ │              │
│  │     • 巡逻 (patrol)                       │   │ │              │
│  │     • 追击 (chase)                        │   │ │              │
│  │     • 攻击 (attack)                       │   │ │              │
│  │     • 撤退 (retreat)                      │   │ │              │
│  └──────────────────────────────────────────┘   │ │              │
└─────────────────────────────────────────────────┘ │              │
        │                                           │              │
        ▼                                           ▼              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       敌人实体                                     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────────┐│
│  │  Enemy_1     │ │  Enemy_2     │ │     Enemy_Smart         ││
│  │  (原有敌人)   │ │  (原有敌人)   │ │  (新的智能敌人)          ││
│  │              │ │              │ │  • 内置EnhancedAI       ││
│  │ + 可选AI增强 │ │ + 可选AI增强 │ │  • 战术策略              ││
│  └──────────────┘ └──────────────┘ │  • 开箱即用              ││
│                                     └──────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘


                  数据流向示意图
                  
EventBus ──────────> AIManager
   │                    │
   │ (玩家受伤)          │ (更新追踪)
   │ (敌人死亡)          │
   │ (成功闪避)          │
   │                    ▼
   │              ┌──────────────┐
   │              │ 性能评分系统  │
   │              │              │
   │              │ • 计算KD比   │
   │              │ • 伤害统计   │
   │              │ • 技巧评分   │
   │              └──────────────┘
   │                    │
   │                    ▼
   │              ┌──────────────┐
   │              │ 难度调整引擎  │
   │              │              │
   │              │ 玩家强→提高   │
   │              │ 玩家弱→降低   │
   │              └──────────────┘
   │                    │
   │                    ▼
   └──────────────> 敌人AI参数
                   • 反应速度
                   • 攻击频率
                   • 决策质量


              AI系统交互流程
              
1. 游戏开始
   └─> 初始化AIManager
       └─> 设置默认难度
       
2. 敌人生成
   └─> 创建敌人实体
       └─> 添加EnhancedAI (可选)
           └─> 选择AI策略
           
3. 游戏进行中
   └─> 每帧更新
       ├─> AIManager追踪玩家表现
       ├─> 敌人AI感知环境
       ├─> 敌人AI做出决策
       └─> 敌人AI执行动作
       
4. 战斗事件
   └─> EventBus广播事件
       └─> AIManager接收并记录
           └─> 更新表现指标
               └─> 调整难度参数
               
5. 玩家交互
   ├─> 查看表现评估
   ├─> 获取AI助手建议
   └─> 与NPC对话


              性能优化策略
              
┌────────────────────────────────────┐
│  1. 决策冷却                         │
│     • 每秒1次决策，非每帧             │
│     • 减少CPU消耗                    │
└────────────────────────────────────┘

┌────────────────────────────────────┐
│  2. LOD系统 (可扩展)                 │
│     • 远距离敌人使用简化AI            │
│     • 屏幕外敌人降低更新频率           │
└────────────────────────────────────┘

┌────────────────────────────────────┐
│  3. 事件驱动                         │
│     • 基于EventBus，避免轮询          │
│     • 按需更新，不做无用计算           │
└────────────────────────────────────┘


           使用场景示例
           
场景1: 普通关卡
┌──────────────────────────────────┐
│ 难度: NORMAL                      │
│ 敌人配置:                         │
│ • 2个 TACTICAL (战术型)           │
│ • 1个 AGGRESSIVE (激进型)         │
│ • 1个 DEFENSIVE (防御型)          │
└──────────────────────────────────┘

场景2: BOSS战
┌──────────────────────────────────┐
│ 难度: ADAPTIVE                    │
│ BOSS配置:                         │
│ • 策略: ADAPTIVE                  │
│ • 根据玩家表现动态调整             │
│ • 血量低时变防御，血量高时激进      │
└──────────────────────────────────┘

场景3: 新手教程
┌──────────────────────────────────┐
│ 难度: EASY                        │
│ 特性:                             │
│ • 敌人反应慢                      │
│ • AI助手启用                      │
│ • 提供实时建议                     │
└──────────────────────────────────┘
```

## 关键设计理念

1. **模块化**: 每个AI组件独立，易于维护和扩展
2. **可配置**: 参数化设计，方便调整平衡性
3. **向后兼容**: 不影响现有代码，渐进式集成
4. **性能优先**: 优化算法，减少运行时开销
5. **可扩展**: 预留接口，支持未来功能扩展

## 扩展方向

- [ ] 机器学习集成 (TensorFlow.js)
- [ ] 多智能体协作系统
- [ ] 语言模型对话 (GPT集成)
- [ ] 情感系统
- [ ] 学习型AI (从玩家行为中学习)
